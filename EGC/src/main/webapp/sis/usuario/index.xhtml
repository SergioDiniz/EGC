<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:jsf="http://xmlns.jcp.org/jsf"
      xmlns:c="http://java.sun.com/jsp/jstl/core"

      xmlns:p="http://primefaces.org/ui">

    <h:head>



        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>

        <title>EGC - Usuário</title>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
    </h:head>

    <h:body class="ui-desktop">



        <div class="tudo hidden-xs">

            <div id="menu">
                <ui:include src="topo.xhtml"/>
            </div>

            <div id="menu-lateral">
                <ui:include src="menulateral.xhtml"/>
            </div>
        </div>

        <div class="area-titulo-pagina hidden-xs">

            <div class="col-md-5">
                <div class="titulo-pagina">Bem Vindo!</div>
            </div>

            <div class="tudo">
                <div class="col-md-offset-4 col-md-3 magin-btn-nd">
                    <div class="btn-nova-denuncia">
                        <a href="denuncia.jsf">
                            <button class="btn-nova-denuncia" data-toggle="modal" data-target="#myModal" >
                                <div class="icon-btn-vd bnt-vd">
                                    +
                                </div>
                                <div class="text-bnt-vd bnt-vd">
                                    nova denúncia
                                </div>
                            </button>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="tudo hidden-xs">

            <!-- -->
            <div class="menu-filtro">
                <div class="row">


                    <div class="barra-pesquisa-usuario">         
                        <h:form acceptcharset="ISO-8859-1">
                            <h:inputText class="form-control input-lg" value="#{controladorUsuario.strPesquisarCidadeFiltro}" pt:placeholder="Pesquisar Cidade"/>
                            <h:commandButton value="teste" class="hidden" action="#{controladorUsuario.pesquisarCidadeFiltro()}"/>
                        </h:form>
                    </div>
                </div>

                <div class="row">
                    <div class="cidade-atual">

                        <h:outputText value="#{controladorUsuario.cidadeDenuncia} - #{controladorUsuario.ufDenuncia}"/>

                    </div>
                </div>

                <div class="row">
                    <div class="info-denuncias-atendidas">
                        <div class="col-md-6 info-denuncias">

                            <div class="info-texto">DENUNCIAS</div>

                            <div class="info-texto-numero">
                                <h:outputText value="#{controladorUsuario.totalDeDenunciasNaCidade()}"/>
                            </div>

                        </div>

                        <div class="col-md-6 info-atendidas">

                            <div class="info-texto">ATENDIDAS</div>

                            <div class="info-texto-numero">
                                <h:outputText value="#{controladorUsuario.totalDeDenunciasAtendidasNaCidade()}"/>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="filtro">
                        <h:form>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="texto-filtro">Filtro</div>
                                </div>
                                <div class="col-md-8 icone-organizar-denuncia">
                                    <div class="col-md-2">
                                        <span class="tooltips" title="Brasil" rel="tooltip" data-placement="top" >
                                            <h:commandLink action="#{controladorUsuario.denunciasBrasil()}">
                                                <img src="../../img/icones-denuncia/icone-mundo.png"/>
                                            </h:commandLink>
                                        </span>
                                    </div>
                                    <div class="col-md-2">
                                        <span class="tooltips" title="Todas" rel="tooltip" data-placement="top" >
                                            <h:commandLink action="#{controladorUsuario.denunciasTodos()}">
                                                <img src="../../img/icones-denuncia/icone-mostrar-todas.png"/>
                                            </h:commandLink>
                                        </span>
                                    </div>
                                    <div class="col-md-2">
                                        <span class="tooltips" title="Or. Por Data de Publicação" rel="tooltip" data-placement="top" >
                                            <h:commandLink action="#{controladorUsuario.denunciasOrdemData()}">

                                                <c:choose>
                                                    <c:when test="#{controladorUsuario.ordemDenuncia == 'data'}">
                                                        <img src="../../img/icones-denuncia/icon-organizar-por-data.png" class="ordem-ativa" style="margin-top: -6px;"/>
                                                    </c:when>

                                                    <c:otherwise>
                                                        <img src="../../img/icones-denuncia/icon-organizar-por-data.png" style="margin-top: -1px;"/>
                                                    </c:otherwise>
                                                </c:choose>

                                            </h:commandLink>
                                        </span>
                                    </div>
                                    <div class="col-md-2">
                                        <span class="tooltips" title="Or. Por Reclamação" rel="tooltip" data-placement="top" >
                                            <h:commandLink action="#{controladorUsuario.denunciasOrdemReclamacao()}">

                                                <c:choose>
                                                    <c:when test="#{controladorUsuario.ordemDenuncia == 'reclamacao'}">
                                                        <img src="../../img/icones-denuncia/icone-organizar-por-reclamacao.png" class="ordem-ativa"/>
                                                    </c:when>

                                                    <c:otherwise>
                                                        <img src="../../img/icones-denuncia/icone-organizar-por-reclamacao.png" />
                                                    </c:otherwise>
                                                </c:choose>

                                            </h:commandLink>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="todos-icones-filtro">
                                <div class="row">
                                    <div>
                                        <div class="col-md-3 icone-filtro">
                                            <span class="tooltips" title="Coleta de Lixo" rel="tooltip" data-placement="top" >
                                                <h:commandLink action="#{controladorUsuario.denunciasColetaDeLixo()}">
                                                    <img src="../../img/icones-denuncia/icone-lixo.png"/>
                                                </h:commandLink>
                                            </span>
                                        </div>
                                        <div class="col-md-3 icone-filtro">
                                            <span class="tooltips" title="Iluminação Publica" rel="tooltip" data-placement="top" >
                                                <h:commandLink action="#{controladorUsuario.denunciasIluminacaoPublica()}">
                                                    <img src="../../img/icones-denuncia/icone-iluminação.png"/>
                                                </h:commandLink>
                                            </span>
                                        </div>
                                        <div class="col-md-3 icone-filtro">
                                            <span class="tooltips" title="Distribuição e Qualidade da Agua" rel="tooltip" data-placement="top" >
                                                <h:commandLink action="#{controladorUsuario.denunciasQualidadeAgua()}">
                                                    <img src="../../img/icones-denuncia/icone-agua-esgoto.png"/>
                                                </h:commandLink>
                                            </span>
                                        </div>
                                        <div class="col-md-3 icone-filtro">
                                            <span class="tooltips" title="Poda e Manutenção de Arvores" rel="tooltip" data-placement="top" >
                                                <h:commandLink action="#{controladorUsuario.denunciasPodaDeArvores()}">
                                                    <img src="../../img/icones-denuncia/icone-arvores.png"/>
                                                </h:commandLink>
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div>
                                        <div class="col-md-3 icone-filtro">
                                            <span class="tooltips" title="Obras Publicas" rel="tooltip" data-placement="top" >
                                                <h:commandLink action="#{controladorUsuario.denunciasObrasPublicas()}">
                                                    <img src="../../img/icones-denuncia/icone-obras-publicas.png"/>
                                                </h:commandLink>
                                            </span>
                                        </div>
                                        <div class="col-md-3 icone-filtro">
                                            <span class="tooltips" title="Poluição Visual" rel="tooltip" data-placement="top" >
                                                <h:commandLink action="#{controladorUsuario.denunciasPoluicaoVisual()}">
                                                    <img src="../../img/icones-denuncia/icone-pulicao-visual.png"/>
                                                </h:commandLink>
                                            </span>
                                        </div>
                                        <div class="col-md-3 icone-filtro">
                                            <span class="tooltips" title="Transito, Sinalização e Placas" rel="tooltip" data-placement="top" >
                                                <h:commandLink action="#{controladorUsuario.denunciasTransitoPlacas()}">
                                                    <img src="../../img/icones-denuncia/icone-transito.png"/>
                                                </h:commandLink>
                                            </span>
                                        </div>
                                        <div class="col-md-3 icone-filtro">
                                            <span class="tooltips" title="Manutenção de Esgotos" rel="tooltip" data-placement="top" >
                                                <h:commandLink action="#{controladorUsuario.denunciasManutencaoEsgoto()}">
                                                    <img src="../../img/icones-denuncia/icone-manutecao-esgoto.png"/>
                                                </h:commandLink>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div>
                                        <div class="col-md-3 icone-filtro">
                                            <span class="tooltips" title="Saúde" rel="tooltip" data-placement="top" >
                                                <h:commandLink action="#{controladorUsuario.denunciasSaude()}">
                                                    <img src="../../img/icones-denuncia/icone-saude.png"/>
                                                </h:commandLink>
                                            </span>
                                        </div>
                                        <div class="col-md-3 icone-filtro">
                                            <span class="tooltips" title="Educação" rel="tooltip" data-placement="top" >
                                                <h:commandLink action="#{controladorUsuario.denunciasEducacao()}">
                                                    <img src="../../img/icones-denuncia/icone-educacao.png"/>
                                                </h:commandLink>
                                            </span>
                                        </div>
                                        <div class="col-md-3 icone-filtro">
                                            <span class="tooltips" title="Acessibilidade" rel="tooltip" data-placement="top" >
                                                <h:commandLink action="#{controladorUsuario.denunciasAcessibilidade()}">
                                                    <img src="../../img/icones-denuncia/icone-acessibilidade.png"/>
                                                </h:commandLink>
                                            </span>
                                        </div>
                                        <div class="col-md-3 icone-filtro">
                                            <span class="tooltips" title="Manutenção de Vias Públicas" rel="tooltip" data-placement="top" >
                                                <h:commandLink action="#{controladorUsuario.denunciasManutencaoViasPublicas()}">
                                                    <img src="../../img/icones-denuncia/icone-manutencao-vias-publicas.png"/>
                                                </h:commandLink>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </h:form>
                    </div>
                </div>

                <div class="row">
                    <div class="info-egc">
                        EGC © 2015&nbsp;&nbsp;|&nbsp;&nbsp;<b>Português - BR</b>
                    </div>
                </div>

            </div>



            <!-- -->

            <div class="container">

                


                <div class="conteudo feed-usuario">   

                    <div class="row">
                        <div class="col-md-offset-2 col-md-6">


                            <!-- -->


                            <!--                            <h:form>
                                                            <p:poll interval="10" listener="#{controladorUsuario.setDenunicasFeed()}" update="feed"/>-->
                            <h:panelGroup id="feed">
                                <c:forEach var="denuncia" items="#{controladorUsuario.feedDenuncias}" id="id-denuncias">
                                    <div class="denuncia-visualizada">

                                        <c:choose>

                                            <c:when test="#{denuncia.tagAtendida()}">
                                                <div class="tag-info-atendimento">
                                                    <span class="tooltips" title="Denuncia Atendida" rel="tooltip" data-placement="top" >
                                                        <img src="../../img/icones-denuncia/tag-atentida-2.png"/> 
                                                    </span>
                                                </div>
                                            </c:when>

                                            <c:when test="#{denuncia.tagEmAndamento()}">
                                                <div class="tag-info-atendimento">
                                                    <span class="tooltips" title="Denuncia em Trabalho" rel="tooltip" data-placement="top" >
                                                        <img src="../../img/icones-denuncia/tag-em-trabalho-2.png"/>
                                                    </span>
                                                </div>
                                            </c:when>

                                        </c:choose>    



                                        <div class="row">
                                            <div class="col-md-2 icone-denuncia">
                                                <img src="../../img/icones-denuncia/#{denuncia.iconeDenunica}" />
                                            </div>
                                            <div class="col-md-8">
                                                <div class="row rua-denuncia">
                                                    #{denuncia.tipoDaDenunciaFormatado}
                                                </div>
                                                <div class="row conteudo-denuncia">
                                                    #{denuncia.descricao}

                                                </div>
                                            </div>
                                        </div>

                                        <div class="row link-mapa-denuncia">
                                            <a href="/EGC/pesquisar/#{denuncia.codigo}">#{denuncia.enderecoDenuncia.toString()}</a> <br/>
                                        </div>

                                        <div class="row">
                                            <div align="center">
                                                <button data-toggle="modal" data-target=".denuncia#{denuncia.id}" class="btn-img">
                                                    <img src="../denuncias/#{denuncia.foto}" class="img-denuncia" />
                                                </button>   
                                            </div>

                                            <!--modal visualizar denuncia--> 
                                            <!-- -->
                                            <div class="modal fade bs-example-modal-lg denuncia#{denuncia.id}" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                                                <div class="modal-dialog modal-lg">
                                                    <div class="modal-content">


                                                        <div class="row">
                                                            <div class="col-md-8 img-modal">
                                                                <img src="../denuncias/#{denuncia.foto}" class="img-denuncia-modal" />
                                                            </div>
                                                            <div class="col-md-4">

                                                                <div class="modal-header btn-fecha-modal">
                                                                    <button type="button" class="close " data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                                                </div>

                                                                <div class="row">
                                                                    <div class="col-md-2 icone-denuncia">
                                                                        <img src="../../img/icones-denuncia/#{denuncia.iconeDenunica}" />
                                                                    </div>
                                                                    <div class="col-md-8">
                                                                        <div class="row rua-denuncia">
                                                                            #{denuncia.tipoDaDenunciaFormatado}
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="row conteudo-denuncia-modal">
                                                                    <div class="scroll">
                                                                        #{denuncia.descricao} 


                                                                        <iframe src="mapa.jsf?latitude=#{denuncia.enderecoDenuncia.latitude}&amp;longitude=#{denuncia.enderecoDenuncia.longitude}&amp;" class="frame-mapa" width="100%" height="110px" style="border: none" scrolling="no"></iframe>





                                                                        <c:choose>

                                                                            <c:when test="#{denuncia.tagEmAndamento()}">
                                                                                <span class="tooltips" title="Denuncia em Trabalho" rel="tooltip" data-placement="top" >
                                                                                    <div class="modal-inf-em-trabalho">
                                                                                        EM TRABALHO
                                                                                    </div>
                                                                                </span>
                                                                            </c:when>

                                                                            <c:when test="#{denuncia.tagAtendida()}">
                                                                                <span class="tooltips" title="Denuncia Atendida" rel="tooltip" data-placement="top" >
                                                                                    <div class="modal-inf-atendida">
                                                                                        ATENDIDA
                                                                                    </div>
                                                                                </span>
                                                                            </c:when>


                                                                        </c:choose>

                                                                        <h:panelGroup rendered="#{denuncia.tagAtendida()}">
                                                                            <br/>
                                                                            <div>
                                                                                <label>Informações de Atendimento</label>
                                                                                <div>
                                                                                    <img src="/EGC/sis/denuncias/#{denuncia.informacaoDeAtendida.foto}" width="393px"/>
                                                                                </div>
                                                                                <div>
                                                                                    #{denuncia.informacaoDeAtendida.descricao}
                                                                                </div>
                                                                            </div>
                                                                        </h:panelGroup>


                                                                        <br/>
                                                                        <label>Registros:</label>

                                                                        <c:forEach var="registro" items="#{denuncia.registros}" >
                                                                            <table class="tb-registro">
                                                                                <tr>

                                                                                    <td>
                                                                                        <img src="/EGC/img/icon-calendario.png" width="40px"/>
                                                                                    </td>

                                                                                    <td>
                                                                                        <div class="td-dia-semana">
                                                                                            #{registro.diaDaSemana()} 
                                                                                        </div>
                                                                                        <div class="td-data-semana">
                                                                                            #{registro.dataFormatada()}
                                                                                        </div>
                                                                                    </td>



                                                                                    <td>
                                                                                        <div class="td-registro">
                                                                                            <c:choose>
                                                                                                <c:when test="#{registro.tipoDeRegistro == 'DENUNCIA_EM_TRABALHO'}">
                                                                                                    atualizada para o estado <span class="label label-info">Em trabalho</span>
                                                                                                </c:when>
                                                                                                <c:when test="#{registro.tipoDeRegistro == 'DENUNCIA_ATENDIDA'}">
                                                                                                    atualizada para o estado <span class="label label-success">Atendida</span>
                                                                                                </c:when>
                                                                                                <c:when test="#{registro.tipoDeRegistro == 'AGUARDANDO'}">
                                                                                                    atualizada para o estado <span class="label label-default">Aguardando</span>
                                                                                                </c:when>
                                                                                                <c:otherwise>
                                                                                                    recebeu uma <span class="label label-danger">Reclamação</span>
                                                                                                </c:otherwise>
                                                                                            </c:choose>
                                                                                        </div>
                                                                                    </td>

                                                                                </tr>

                                                                            </table>

                                                                        </c:forEach>



                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- -->


                                        </div>

                                        <div class="row rodape-denuncia">
                                            <div class="col-md-4 hora-denuncia-visualizada">
                                                #{denuncia.dataDenuncaFormatado}
                                            </div>

                                            <div class="col-md-offset-5 col-md-3 impucionar-denuncia">
                                                <div class="col-md-6">
                                                    <span class="tooltips" title="Ajudar" rel="tooltip" data-placement="top" >
                                                        <h:form>
                                                            <p:growl id="growl"/>
                                                            <c:choose>
                                                                <c:when test="#{!controladorUsuario.denunciasQueAjudei().contains(denuncia)}">
                                                                    <p:commandButton value="+#{controladorUsuario.getAjudarDenuncia(denuncia)}" id="n-ajuda#{denuncia.id}" actionListener="#{controladorUsuario.setAjudarDenuncia(denuncia)}" styleClass="btn-ajudar-denuncia"/>
                                                                </c:when>
                                                                <c:otherwise>
                                                                    <p:commandButton value="+#{controladorUsuario.getAjudarDenuncia(denuncia)}" id="n-ajuda#{denuncia.id}"  actionListener="#{controladorUsuario.setAjudarDenuncia(denuncia)}" styleClass="btn-ajudar-denuncia" disabled="true"/>
                                                                </c:otherwise>
                                                            </c:choose>


                                                            <p:poll interval="3" update="n-ajuda#{denuncia.id}" />
                                                        </h:form>
                                                    </span>
                                                </div>
                                                <div class="col-md-6">
                                                    <span class="tooltips" title="Reclamar" rel="tooltip" data-placement="top" >

                                                        <h:form >
                                                            <button data-toggle="modal" data-target=".denunciaReclamacao#{denuncia.id}" class="btn-ajudar-denuncia">
                                                                <h:outputText value="-#{controladorDenuncia.getReclamarDenuncia(denuncia)}" id="n-reclamar#{denuncia.id}"/>
                                                                <p:poll interval="3" update="n-reclamar#{denuncia.id}"/>
                                                            </button>
                                                        </h:form>

                                                    </span>

                                                    <!--modal reclamação--> 
                                                    <div id="modal-reclamacao">
                                                        <div class="modal fade bs-example-modal-lg denunciaReclamacao#{denuncia.id}" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                                                            <div class="modal-dialog">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                                                        <h4 class="modal-title">O que está acontecendo?</h4>

                                                                    </div>

                                                                    <h:form enctype="multipart/form-data" acceptcharset="ISO-8859-1">

                                                                        <div class="modal-body">
                                                                            <p align="center" style="font-size: 16px">Nos ajude a identificar o que há de errado com esta denúncia.</p>
                                                                            <br/>
                                                                            <div class="row">

                                                                                <div class="col-md-5">
                                                                                    <img src="../denuncias/#{denuncia.foto}" style="width: 100%; max-height: 100%;" />
                                                                                </div>
                                                                                <div class="col-md-7">

                                                                                    <div class="form-group">
                                                                                        <label>Tipo de Conteúdo: </label>
                                                                                        <h:selectOneListbox size="1" class="form-control" value="#{controladorDenuncia.conteudoInapropriado.tipoDeConteudo}">
                                                                                            <f:selectItem itemValue="FALSA_DENUNCIA" itemLabel="Falsa Denúncia" />
                                                                                            <f:selectItem itemValue="NUDEZ" itemLabel="Exposição de Nudez"/>
                                                                                            <f:selectItem itemValue="SPAN" itemLabel="Span"/>
                                                                                            <f:selectItem itemValue="IRRITANTE" itemLabel="Essa denúncia me irrita"/>
                                                                                        </h:selectOneListbox>
                                                                                    </div>

                                                                                    <div class="form-group">
                                                                                        <label>Descrição:</label>
                                                                                        <textarea class="form-control" rows="6" jsf:value="${controladorDenuncia.conteudoInapropriado.descricao}">
                                                
                                                                                        </textarea>
                                                                                    </div>

                                                                                </div>

                                                                            </div>
                                                                        </div>
                                                                        <div class="modal-footer">
                                                                            <button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
                                                                            <h:commandButton value="Reclamar" action="#{controladorDenuncia.setReclamarDenuncia(denuncia)}" class="btn btn-primary"/>
                                                                        </div>

                                                                    </h:form>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>

                                    </div>


                                </c:forEach>
                            </h:panelGroup>
                            <!--</h:form>-->



                            <!-- -->

                        </div>
                    </div>


                </div>
            </div>
        </div>


    </h:body>
    <script>
        if (Modernizr.mq('(max-width: 767px)')) {
            window.location = "/EGC/sis/m/index.jsf";
        }
    </script>
    <style type="text/css">
        body{
            background-color: #f9f9f9;    
            background-image: url(../../img/bng-btn.jpg);
            background-repeat: repeat-x;
            background-position: 0 50px;
        }
    </style>

    <script>
        $('.tooltips').tooltip('hide')
    </script>
</html>


